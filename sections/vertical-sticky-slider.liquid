{%- style -%}
  .vertical-slider-{{ section.id }} {
    margin-top: {{ section.settings.margin_top }}px;
    margin-bottom: {{ section.settings.margin_bottom }}px;
  }

  .vertical-slider-{{ section.id }} h2 { font-size: 30px; text-transform: uppercase; margin: 1rem 0; }
  .vertical-slider-{{ section.id }} h3 { font-size: 40px; text-transform: uppercase; margin: 1rem 0; }

  .mobile-only { display: block; }
  .desktop-only { display: none !important; }

  @media (max-width: 1023px) {
    .image-wrapper { height: 100vw; overflow: hidden; max-height: 500px; }
    .image-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    .content { text-align: center; padding: 4rem 2rem; }
  }

  @media (min-width: 1024px) {
    .vertical-slider-{{ section.id }} h2 { font-size: 50px; }
    .vertical-slider-{{ section.id }} h3 { font-size: 60px; }
    .mobile-only { display: none !important; }
    .desktop-only { display: flex !important; }

    .vertical-slider { display: flex; width: 100%; }
    .vertical-slider > * { width: 50%; }
    .sticky { position: sticky; top: 0; height: 100vh; overflow: hidden; }
    .absolute-full { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    .image-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    .content-wrapper { min-height: 100vh; opacity: 0.2; transition: opacity 0.5s ease-out; display: flex; align-items: center; justify-content: center; }
    .content-wrapper.in-view { opacity: 1; }
    .content { padding: 5rem 2rem; text-align: center; }

    /* Mask Animation */
    .image-wrapper .mask-outer { transform: translateY(100%); overflow: hidden; transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    .image-wrapper .mask-inner { transform: translateY(-100%); transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    .image-wrapper.show { z-index: 2; }
    .image-wrapper.show .mask-outer, .image-wrapper.show .mask-inner { transform: translateY(0); }
  }
{%- endstyle -%}

<div class="vertical-slider-{{ section.id }}">
  <div class="mobile-only">
    {% for block in section.blocks %}
      <section {{ block.shopify_attributes }}>
        <div class="image-wrapper">
          {% if block.settings.image != blank %}
            {{ block.settings.image | image_url: width: 1000 | image_tag: loading: 'lazy' }}
          {% else %}
            {{ 'image' | placeholder_svg_tag }}
          {% endif %}
        </div>
        <div class="content-wrapper">
          <div class="content">
            <h2>{{ block.settings.heading }}</h2>
            <h3>{{ block.settings.subheading }}</h3>
          </div>
        </div>
      </section>
    {% endfor %}
  </div>

  <div class="desktop-only vertical-slider">
    <div class="left-side">
      <div class="sticky">
        {% for block in section.blocks %}
          <div
            class="image-wrapper absolute-full {% if forloop.first %}show{% endif %}"
            data-index="{{ forloop.index0 }}"
          >
            <div class="mask-outer absolute-full">
              <div class="mask-inner absolute-full">
                {% if block.settings.image != blank %}
                  {{ block.settings.image | image_url: width: 1400 | image_tag: loading: 'lazy' }}
                {% else %}
                  {{ 'lifestyle-1' | placeholder_svg_tag: 'absolute-full' }}
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="right-side">
      {% for block in section.blocks %}
        <section class="content-wrapper" data-index="{{ forloop.index0 }}">
          <div class="content">
            <h2>{{ block.settings.heading }}</h2>
            <h3>{{ block.settings.subheading }}</h3>
          </div>
        </section>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const sectionContainer = document.querySelector('.vertical-slider-{{ section.id }}');
    const imageWrappers = sectionContainer.querySelectorAll('.desktop-only .left-side .image-wrapper');
    const contentWrappers = sectionContainer.querySelectorAll('.desktop-only .right-side .content-wrapper');

    const observerOptions = {
      root: null,
      threshold: 0.6,
    };

    const observerCallback = (entries) => {
      entries.forEach((entry) => {
        const index = parseInt(entry.target.dataset.index);
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
          imageWrappers.forEach((img, i) => {
            if (i === index) {
              img.classList.add('show');
            } else if (i > index) {
              img.classList.remove('show');
            }
          });
        } else {
          entry.target.classList.remove('in-view');
        }
      });
    };

    const observer = new IntersectionObserver(observerCallback, observerOptions);
    contentWrappers.forEach((wrapper) => observer.observe(wrapper));
  });
</script>

{% schema %}
{
  "name": "Vertical Sticky Slider",
  "settings": [
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Heading"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Sub-Heading",
          "default": "Sub-heading text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Vertical Sticky Slider",
      "blocks": [{ "type": "slide" }, { "type": "slide" }, { "type": "slide" }]
    }
  ]
}
{% endschema %}
